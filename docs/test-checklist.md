# 테스트 체크리스트 (Test Checklist)

**프로젝트**: STM32 Dam Control System  
**버전**: 1.0  
**작성일**: 2025-01-31

---

## 1. 단위 테스트 (Unit Test)

### 1.1 DHT11 드라이버 테스트

#### TC-DHT-01: 초기화 테스트
- [ ] `DHT11_Init()` 호출 후 에러 없음
- [ ] GPIO 핀이 출력 모드로 설정됨
- [ ] 타이머(TIM2) 정상 동작

#### TC-DHT-02: 데이터 읽기 테스트
- [ ] 정상 환경에서 온도/습도 읽기 성공
- [ ] 읽은 값이 유효 범위 내 (온도: 0-50°C, 습도: 20-90%)
- [ ] 체크섬 검증 통과

#### TC-DHT-03: 에러 처리 테스트
- [ ] 센서 연결 해제 시 실패 반환
- [ ] 타임아웃 발생 시 0 반환
- [ ] 체크섬 오류 시 실패 처리

**테스트 방법**:
```c
DHT11_Data_t data;
if (DHT11_Read(&data)) {
    printf("Temp: %.1f, Humi: %.1f\n", data.temperature, data.humidity);
} else {
    printf("Read failed\n");
}
```

---

### 1.2 I2C LCD 드라이버 테스트

#### TC-LCD-01: 초기화 테스트
- [ ] `LCD_Init()` 후 LCD 화면 켜짐
- [ ] 백라이트 정상 동작
- [ ] I2C 통신 정상 (ACK 수신)

#### TC-LCD-02: 문자 출력 테스트
- [ ] `LCD_Print("Hello")` 정상 표시
- [ ] 한글 표시 (지원 시)
- [ ] 특수문자 표시 (%, °C)

#### TC-LCD-03: 커서 이동 테스트
- [ ] `LCD_SetCursor(0, 0)` → 첫 줄 첫 칸
- [ ] `LCD_SetCursor(1, 5)` → 둘째 줄 6번째 칸
- [ ] 범위 초과 시 에러 처리

#### TC-LCD-04: 화면 클리어 테스트
- [ ] `LCD_Clear()` 후 화면 전체 지워짐
- [ ] 커서 홈 위치 복귀

**테스트 방법**:
```c
LCD_Clear();
LCD_SetCursor(0, 0);
LCD_Print("Water: 75.3%");
LCD_SetCursor(1, 0);
LCD_Print("Temp: 23.5C");
```

---

### 1.3 키패드 드라이버 테스트

#### TC-KEY-01: 키 스캔 테스트
- [ ] 각 키(0-9, A-D, *, #) 눌렀을 때 올바른 값 반환
- [ ] 아무 키도 안 눌렀을 때 0 반환
- [ ] 동시에 여러 키 눌렀을 때 첫 번째 키만 반환

#### TC-KEY-02: 디바운싱 테스트
- [ ] 키 눌렀다 뗐다 반복해도 한 번만 인식
- [ ] 50ms 디바운싱 동작 확인

**테스트 방법**:
```c
char key = Keypad_Scan();
if (key != 0) {
    printf("Key pressed: %c\n", key);
}
```

---

### 1.4 데이터 로거 테스트

#### TC-LOG-01: UART 전송 테스트
- [ ] `Logger_Send()` 호출 시 데이터 전송
- [ ] PC에서 시리얼 모니터로 수신 확인
- [ ] CSV 형식 올바름

#### TC-LOG-02: 데이터 형식 테스트
- [ ] Timestamp, WaterLevel, Temp, Humi 순서 정확
- [ ] 소수점 자리수 일관성 (소수점 1자리)

**테스트 방법**:
- PuTTY/Tera Term으로 115200bps 연결
- 출력 예시: `1234,75.3,23.5,45.2`

---

## 2. 통합 테스트 (Integration Test)

### 2.1 센서-LCD 연동 테스트

#### TC-INT-01: 수위 표시
- [ ] ADC 값 읽기 → 퍼센트 변환 → LCD 표시
- [ ] 센서 값 변경 시 LCD 업데이트 (1초 내)

#### TC-INT-02: 온습도 표시
- [ ] DHT11 읽기 → LCD 표시
- [ ] 온도/습도 동시 표시
- [ ] 읽기 실패 시 에러 메시지 표시

**예상 출력**:
```
Water: 75.3%
Temp:23.5C H:45%
```

---

### 2.2 키패드-메뉴 연동 테스트

#### TC-INT-03: 메뉴 네비게이션
- [ ] 메인 메뉴에서 '1' → 수위 화면
- [ ] 메인 메뉴에서 '2' → 온습도 화면
- [ ] 메인 메뉴에서 '3' → 설정 화면
- [ ] 각 화면에서 '#' → 메인 메뉴 복귀

#### TC-INT-04: 임계값 설정
- [ ] '3' 누르면 설정 모드 진입
- [ ] 숫자 키로 값 입력 가능
- [ ] '*' 키로 입력 완료
- [ ] 설정값 저장 확인

---

### 2.3 데이터 로깅 연동 테스트

#### TC-INT-05: 전체 데이터 플로우
- [ ] 센서 읽기 → 데이터 구조체 생성 → UART 전송
- [ ] 1초 주기로 자동 전송
- [ ] PC에서 실시간 모니터링 가능

---

## 3. 시스템 테스트 (System Test)

### 3.1 기능 테스트

#### TC-SYS-01: 수위 모니터링
**시나리오**:
1. 시스템 부팅
2. 메인 메뉴에서 '1' 선택
3. 수위 센서를 물에 담그기
4. 수위 변화 확인

**통과 조건**:
- [ ] 수위가 0-100% 범위로 표시됨
- [ ] 센서 깊이에 따라 값이 증가함
- [ ] LCD에 실시간 업데이트됨

#### TC-SYS-02: 온습도 모니터링
**시나리오**:
1. 메인 메뉴에서 '2' 선택
2. DHT11 센서에 입김 불기
3. 온도/습도 변화 확인

**통과 조건**:
- [ ] 온도 상승 감지
- [ ] 습도 증가 감지
- [ ] 1초 내 업데이트

#### TC-SYS-03: 경보 기능
**시나리오**:
1. 임계값 80%로 설정
2. 수위 센서를 깊이 담가 90% 도달
3. 경보 발생 확인

**통과 조건**:
- [ ] LCD에 "!! ALARM !!" 표시
- [ ] UART로 경보 메시지 전송
- [ ] 수위가 임계값 미만이 되면 경보 해제

---

### 3.2 성능 테스트

#### TC-SYS-04: 응답 시간
- [ ] 키 입력 후 LCD 반영: < 100ms
- [ ] 센서 값 변화 감지: < 1초
- [ ] UART 전송 지연: < 10ms

#### TC-SYS-05: 장시간 동작
- [ ] 24시간 연속 동작 시 에러 없음
- [ ] 메모리 누수 없음 (RAM 사용량 일정)
- [ ] 센서 읽기 실패율 < 1%

---

### 3.3 에러 처리 테스트

#### TC-SYS-06: DHT11 연결 해제
**시나리오**:
1. 시스템 동작 중 DHT11 연결 해제
2. 에러 메시지 확인

**통과 조건**:
- [ ] "Sensor Error" 메시지 표시
- [ ] 이전 값 유지 (새 값 업데이트 안 됨)
- [ ] 재연결 시 자동 복구

#### TC-SYS-07: LCD 통신 오류
**시나리오**:
1. I2C 배선 일시적 단락
2. 통신 오류 처리 확인

**통과 조건**:
- [ ] 재초기화 시도
- [ ] 3회 재시도 후 에러 플래그 설정

---

## 4. 테스트 환경

### 4.1 하드웨어 구성
```
STM32F411 개발보드
├─ PA0: 수위 센서 (물컵 준비)
├─ PC0: DHT11 (실온 환경)
├─ PB6/PB7: I2C LCD (연결 확인)
├─ PB0-PB15: 4x4 키패드
└─ PA9/PA10: USB-TTL (PC 연결)
```

### 4.2 소프트웨어 도구
- **디버거**: STM32CubeIDE Debugger
- **시리얼 모니터**: PuTTY (115200bps, 8N1)
- **로직 분석기**: 선택사항 (I2C, DHT11 신호 확인)

---

## 5. 테스트 진행 방법

### 5.1 단위 테스트
1. 각 드라이버 파일별로 테스트 함수 작성
2. `main()` 에서 테스트 함수 호출
3. UART로 결과 출력
4. 통과/실패 기록

### 5.2 통합 테스트
1. 전체 시스템 빌드
2. 실제 하드웨어 연결
3. 시나리오별 수동 테스트
4. 체크리스트 작성

### 5.3 문제 발견 시
1. 증상 기록 (UART 로그, LCD 상태)
2. 디버거로 중단점 설정
3. 변수 값 확인
4. 수정 후 재테스트

---

## 6. 테스트 결과 기록 양식

| 테스트 ID | 날짜 | 결과 | 비고 |
|----------|------|------|------|
| TC-DHT-01 | 2025-01-31 | ✅ PASS | |
| TC-DHT-02 | 2025-01-31 | ✅ PASS | |
| TC-DHT-03 | 2025-01-31 | ❌ FAIL | 체크섬 오류 처리 누락 → 수정 필요 |
| ... | | | |

---

## 7. 회귀 테스트 (Regression Test)

### 코드 수정 시 필수 재테스트 항목

| 수정 영역 | 재테스트 항목 |
|---------|-------------|
| dht11.c | TC-DHT-01~03, TC-INT-02 |
| i2c-lcd.c | TC-LCD-01~04, 모든 TC-INT |
| keypad.c | TC-KEY-01~02, TC-INT-03~04 |
| ap.c | 전체 테스트 (TC-SYS-01~07) |

---

## 8. 테스트 자동화 (선택사항)

### 8.1 유닛 테스트 자동화 (Unity 프레임워크)

```c
#include "unity.h"

void test_DHT11_Read(void) {
    DHT11_Data_t data;
    TEST_ASSERT_EQUAL(1, DHT11_Read(&data));
    TEST_ASSERT_FLOAT_WITHIN(50.0, 25.0, data.temperature);
}

int main(void) {
    UNITY_BEGIN();
    RUN_TEST(test_DHT11_Read);
    return UNITY_END();
}
```

### 8.2 CI/CD 통합 (GitHub Actions)

```yaml
# .github/workflows/test.yml
name: Build and Test
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install ARM GCC
      - name: Build Project
      - name: Run Unit Tests
```

---

## 9. 알려진 이슈 및 제한사항

### 현재 알려진 이슈
- DHT11 센서: 온도 정확도 ±2°C (센서 스펙)
- 키패드: 동시 다중 키 입력 미지원 (설계상 제한)
- ADC: 전압 변동 시 노이즈 발생 가능 → 필터링 필요

### 테스트 범위 제외
- 극한 환경 테스트 (-20°C 이하, 60°C 이상)
- EMC/EMI 테스트
- 장기 신뢰성 테스트 (수개월)

---

## 10. 테스트 완료 조건

모든 시스템 테스트 항목(TC-SYS-01~07)이 통과되면 릴리즈 가능.

- [ ] 모든 단위 테스트 통과
- [ ] 모든 통합 테스트 통과
- [ ] 모든 시스템 테스트 통과
- [ ] 24시간 안정성 테스트 통과
- [ ] 알려진 치명적 버그 없음
